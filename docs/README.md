# è‹±æ¤œå­¦ç¿’ã‚¢ãƒ—ãƒª

Djangoè£½ã®è‹±æ¤œå­¦ç¿’Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚æ–‡æ³•ã€ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ãƒªã‚¹ãƒ‹ãƒ³ã‚°å•é¡Œã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦è¦ä»¶
- Python 3.9+
- PostgreSQL (æœ¬ç•ªç’°å¢ƒ)
- SQLite (é–‹ç™ºç’°å¢ƒ)

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä»®æƒ³ç’°å¢ƒã®ä½œæˆ
python -m venv venv
source venv/bin/activate  # Windowsã®å ´åˆ: venv\Scripts\activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
python manage.py migrate

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®åé›†
python manage.py collectstatic --noinput

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
python manage.py runserver
```

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ğŸ’° èª²é‡‘å‰Šæ¸›ï¼š2æ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### Phase 1: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— âœ…
å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦DBä½¿ç”¨é‡ã‚’å‰Šæ¸›

**ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ:**
```bash
fly ssh console -a eiken-app
python manage_production.py cleanup_database --dry-run  # ç¢ºèª
python manage_production.py cleanup_database --vacuum   # å®Ÿè¡Œ
```

è©³ç´°ãªã‚¬ã‚¤ãƒ‰:
- ğŸ“˜ [ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰](QUICK_CLEANUP_GUIDE.md) - ä»Šã™ãå®Ÿè¡Œã™ã‚‹æ–¹æ³•
- ğŸ“— [è©³ç´°ã‚¬ã‚¤ãƒ‰](DATABASE_CLEANUP.md) - å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### Phase 2: ãƒœãƒªãƒ¥ãƒ¼ãƒ ç¸®å°ï¼ˆ10GBâ†’1GBï¼‰ğŸ’¡
ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚µã‚¤ã‚ºã‚’ç¸®å°ã—ã¦**æœˆé¡ç´„$1.35å‰Šæ¸›**

**ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ:**
```bash
./migrate_db_volume.sh  # è‡ªå‹•å®Ÿè¡Œï¼ˆ10åˆ†ã§å®Œäº†ï¼‰
```

è©³ç´°ãªã‚¬ã‚¤ãƒ‰:
- ğŸš€ [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](VOLUME_MIGRATION_QUICK_START.md) - 10åˆ†ã§å®Œäº†
- ğŸ“™ [è©³ç´°ã‚¬ã‚¤ãƒ‰](VOLUME_MIGRATION_GUIDE.md) - å®Œå…¨ãªæ‰‹é †

**å‰Šæ¸›åŠ¹æœ:**
- ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚µã‚¤ã‚º: 10GB â†’ 1GBï¼ˆ90%å‰Šæ¸›ï¼‰
- æœˆé¡ã‚³ã‚¹ãƒˆ: ç´„$1.35å‰Šæ¸›

### è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

GitHub Actionsã§æ¯æœˆè‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™:
1. GitHubã®Settings > Secretsã«`FLY_API_TOKEN`ã‚’è¿½åŠ 
2. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæ¯æœˆ1æ—¥ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™

æ‰‹å‹•å®Ÿè¡Œ: GitHub Actions > "Database Cleanup" > "Run workflow"

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†æ

```bash
fly postgres connect -a eiken-app-db < analyze_db_size.sql
```

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
eiken/
â”œâ”€â”€ accounts/           # ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
â”œâ”€â”€ exams/             # è©¦é¨“ãƒ»å•é¡Œç®¡ç†
â”œâ”€â”€ questions/         # å•é¡Œãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ eiken_project/     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ static/            # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆéŸ³å£°ã€ç”»åƒï¼‰
â”œâ”€â”€ templates/         # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## ğŸ“± æ©Ÿèƒ½

- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
- âœ… æ–‡æ³•ãƒ»èªå½™å•é¡Œ
- âœ… é•·æ–‡èª­è§£å•é¡Œ
- âœ… ãƒªã‚¹ãƒ‹ãƒ³ã‚°å•é¡Œï¼ˆ3éƒ¨æ§‹æˆï¼‰
- âœ… å­¦ç¿’é€²æ—ã®è¨˜éŒ²
- âœ… æ­£ç­”ç‡ã®è¡¨ç¤º
- âœ… ãƒ¬ãƒ™ãƒ«åˆ¥å•é¡Œï¼ˆGrade 4ã€œPre-Grade 1ï¼‰

## ğŸ”§ ç®¡ç†ã‚³ãƒãƒ³ãƒ‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```bash
# Dry runï¼ˆå‰Šé™¤ã›ãšç¢ºèªã®ã¿ï¼‰
python manage.py cleanup_database --dry-run

# å®Ÿéš›ã«å‰Šé™¤ï¼ˆ90æ—¥å‰ã‚ˆã‚Šå¤ã„å›ç­”å±¥æ­´ã€180æ—¥å‰ã‚ˆã‚Šå¤ã„é€²æ—ãƒ‡ãƒ¼ã‚¿ï¼‰
python manage.py cleanup_database

# ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã§å‰Šé™¤
python manage.py cleanup_database --answers-days 60 --progress-days 120

# VACUUMå‡¦ç†ã‚‚å®Ÿè¡Œ
python manage.py cleanup_database --vacuum
```

### å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```bash
python manage.py import_questions
```

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆFly.ioï¼‰

### åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
fly launch
fly postgres create
fly postgres attach eiken-app-db
fly deploy
```

### æ›´æ–°ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
fly deploy
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
```bash
fly ssh console -a eiken-app
fly postgres connect -a eiken-app-db
```

## ğŸ“ˆ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ãƒ­ã‚°ã®ç¢ºèª
```bash
fly logs -a eiken-app
fly logs -a eiken-app-db
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºã®ç¢ºèª
```bash
fly postgres connect -a eiken-app-db
SELECT pg_size_pretty(pg_database_size(current_database()));
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- SECRET_KEYã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- æœ¬ç•ªç’°å¢ƒã§ã¯DEBUG=False
- CSRFå¯¾ç­–ã‚’å®Ÿè£…
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ğŸ‘¥ è²¢çŒ®

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã‚½ãƒ¼ã‚¹ã§ã™ã€‚

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰](DATABASE_CLEANUP.md)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰](QUICK_CLEANUP_GUIDE.md)
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°: `fly logs -a eiken-app`

